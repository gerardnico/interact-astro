---
import themeConfig, {config} from "@gerardnico/interact-config"
import {PAGE_CONTAINER} from "../style/classNames";
interface Props extends Frontmatter {
}
const {title, description, keyWords, robots} = Astro.props;
const primary = themeConfig.colors.primary;
const hexToRgb = hex =>
    hex.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i
        , (m, r, g, b) => '#' + r + r + g + g + b + b)
        .substring(1).match(/.{2}/g)
        .map(x => parseInt(x, 16))

const primaryRgb = hexToRgb(primary);
let style = `
:root {
    --bs-primary: ${primary};
    --bs-primary-rgb: ${primaryRgb};
    --bs-link-color: ${primary};
    --bs-link-color-rgb: ${primaryRgb};
    --bs-body-font-family: "Times New Roman", Times, serif";
}`
let containerMaxWidth = config.theme.layouts?.page?.containerMaxWidth;
if (containerMaxWidth != undefined) {
    style += `
.${PAGE_CONTAINER} {
   max-width: ${containerMaxWidth}
}
`
}
import globalCSS from '../style/global.css?url';
import {Frontmatter} from "../../../types";

//
// Page Title
//
const url = new URL(Astro.request.url);
const base = themeConfig.site.base
const isRoot = url.pathname === base;
let headPageTitle = title ? title : "";
if (!headPageTitle && isRoot) {
    headPageTitle = themeConfig.site.title || 'Default'
}
let pageTitle = headPageTitle + " | " + themeConfig.site.name

//
// head base meta
// so that relative path are calculated relative to this URL
//
// The URL of the page requested so that relative path and anchor are calculated from it
let baseHeadURL = Astro.request.url;
const isDev = process.env.NODE_ENV === 'development';
if (!isDev) {
    baseHeadURL = themeConfig.site.url + url.pathname
}
if (isRoot) {
    // In the root, we need to add a slash otherwise the relative path is calculated
    // to the previous path
    baseHeadURL = `${base}/`;
}
---
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <!-- https://docs.astro.build/en/reference/api-reference/#generator -->
    <meta name="generator" content={Astro.generator}/>
    <meta name="generator" content="Interact"/>
    <base href={baseHeadURL}>
    {description &&
            <meta name="description" content={description}>}
    <title>{pageTitle}</title>
    {themeConfig.site.favicons && Object.entries(themeConfig.site.favicons).map(([faviconPath, faviconProperties]) => (
            <link
                    rel={faviconProperties.rel}
                    href={faviconProperties.image?.href ? faviconProperties.image.href : `/${faviconPath}`}
                    type={faviconProperties.image?.type}
                    sizes={faviconProperties.image?.width && faviconProperties.image?.height ? `${faviconProperties.image.width}x${faviconProperties.image.height}` : ''}
            />
    ))}
    {themeConfig.colors.primary &&
            <meta name="theme-color" content={themeConfig.colors.primary}>}
    <meta name="robots" content={robots ? robots : "index,follow"}>
    {keyWords &&
            <meta name="keywords" content={keyWords}>}
    <!-- Template can inject head components: https://docs.astro.build/en/basics/astro-components/#transferring-slots -->
    <slot name="head"/>
    <!-- Bootstrap CSS -->
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
            integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <style set:html={style}/>
    <link rel="stylesheet" href={globalCSS}>
</head>